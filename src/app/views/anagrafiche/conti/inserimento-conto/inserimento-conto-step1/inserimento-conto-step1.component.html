<div class="animated fadeIn">
    <div class="card card-accent-primary shadow">
        <div class="card-header">
            <strong><i class="fas fa-plus-square"></i> Nuovo Conto - Scelta Party </strong>
        </div>

        <div class="card-body">

            <ng-container *ngIf="!(showSpinner$ | async); else waiting">
                <div class="alert alert-danger" role="alert" *ngIf="isError">
                    {{ messageError }}
                </div>

                <form [formGroup]="ricercaForm" class="form-horizontal">

                    <div class="form-group row">
                        <label for="bic" class="col-2 col-form-label">Bic:</label>
                        <div class="col-4">
                            <div class="input-group">
                                <input id="bic" class="form-control" [class.is-invalid]="bic.invalid && (bic.dirty || bic.touched)" formControlName="bic" [pattern]="'^[a-zA-Z0-9%]+$'"/>
                                <ng-container *ngTemplateOutlet="wildcardTooltip"></ng-container>
                                <div *ngIf="bic.errors?.wildcard && (bic.dirty || bic.touched)" class="invalid-feedback">
                                    Campo non valido per la ricerca con wildcard
                                </div>
                                <div *ngIf="bic.errors?.syntax && (bic.dirty || bic.touched)" class="invalid-feedback">
                                    Campo sintatticamente non valido
                                </div>
                            </div>
                        </div>

                        <label for="tipo" class="col-2 col-form-label">Tipo Party:</label>
                        <div class="col-4">
                            <select id="tipo" class="form-control" [class.is-invalid]="tipo.invalid && (tipo.dirty || tipo.touched)" formControlName="tipo">
                                <option [ngValue]="null">Tutte</option>
                                <option *ngFor="let t of tipiParty" [value]="t.codice">{{t.descrizione}}</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="nome" class="col-2 col-form-label">Nome:</label>
                        <div class="col-4">
                            <div class="input-group">
                                <input id="nome" class="form-control" [class.is-invalid]="nome.invalid && (nome.dirty || nome.touched)" formControlName="nome" maxlength="4000"/>
                                <ng-container *ngTemplateOutlet="wildcardTooltip"></ng-container>
                                <div *ngIf="nome.errors?.wildcard && (nome.dirty || nome.touched)" class="invalid-feedback">
                                    Campo non valido per la ricerca con wildcard
                                </div>
                            </div>
                        </div>

                        <label for="abi" class="col-2 col-form-label">Abi:</label>
                        <div class="col-4">
                            <div class="input-group">
                                <input id="abi" class="form-control" [class.is-invalid]="abi.invalid && (abi.dirty || abi.touched)" formControlName="abi" maxlength="5" [pattern]="'^[0-9%]+$'"/>
                                <ng-container *ngTemplateOutlet="wildcardTooltip"></ng-container>
                                <div *ngIf="abi.errors?.wildcard && (abi.dirty || abi.touched)" class="invalid-feedback">
                                    Campo non valido per la ricerca con wildcard
                                </div>
                                <div *ngIf="abi.errors?.pattern && (abi.dirty || abi.touched)" class="invalid-feedback">
                                    Campo non valido
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="filiale" class="col-2 col-form-label">Filiale:</label>
                        <div class="col-4">
                            <select id="filiale" class="form-control" [class.is-invalid]="filiale.invalid && (filiale.dirty || filiale.touched)" formControlName="filiale">
                                <option [ngValue]="null">Tutte</option>
                                <option *ngFor="let f of filialiRiferimento" [value]="f.codice">{{f.sigla}}</option>
                            </select>
                        </div>

                        <label for="mfiCode" class="col-2 col-form-label">MFI Code:</label>
                        <div class="col-4">
                            <div class="input-group">
                                <input id="mfiCode" class="form-control" [class.is-invalid]="mfiCode.invalid && (mfiCode.dirty || mfiCode.touched)" formControlName="mfiCode" maxlength="160" [pattern]="'^[a-zA-Z0-9%]+$'"/>
                                <ng-container *ngTemplateOutlet="wildcardTooltip"></ng-container>
                                <div *ngIf="mfiCode.errors?.wildcard && (mfiCode.dirty || mfiCode.touched)" class="invalid-feedback">
                                    Campo non valido per la ricerca con wildcard
                                </div>
                                <div *ngIf="mfiCode.errors?.pattern && (mfiCode.dirty || mfiCode.touched)" class="invalid-feedback">
                                    Campo non valido
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="indResidenza" class="col-2 col-form-label">Indicatore di Residenza:</label>
                        <div class="col-4">
                            <div class="input-group">
                                <input id="indResidenza" class="form-control" [class.is-invalid]="indResidenza.invalid && (indResidenza.dirty || indResidenza.touched)" formControlName="indResidenza" maxlength="5" [pattern]="'^[0-9%]+$'"/>
                                <ng-container *ngTemplateOutlet="wildcardTooltip"></ng-container>
                                <div *ngIf="indResidenza.errors?.wildcard && (indResidenza.dirty || indResidenza.touched)" class="invalid-feedback">
                                    Campo non valido per la ricerca con wildcard
                                </div>
                                <div *ngIf="indResidenza.errors?.pattern && (indResidenza.dirty || indResidenza.touched)" class="invalid-feedback">
                                    Campo non valido
                                </div>
                            </div>
                        </div>

                        <label for="catEconomica" class="col-2 col-form-label">Categoria Economica:</label>
                        <div class="col-4">
                            <div class="input-group">
                                <input id="catEconomica" class="form-control" [class.is-invalid]="catEconomica.invalid && (catEconomica.dirty || catEconomica.touched)" formControlName="catEconomica" maxlength="5" [pattern]="'^[0-9%]+$'"/>
                                <ng-container *ngTemplateOutlet="wildcardTooltip"></ng-container>
                                <div *ngIf="catEconomica.errors?.wildcard && (catEconomica.dirty || catEconomica.touched)" class="invalid-feedback">
                                    Campo non valido per la ricerca con wildcard
                                </div>
                                <div *ngIf="catEconomica.errors?.pattern && (catEconomica.dirty || catEconomica.touched)" class="invalid-feedback">
                                    Campo non valido
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group row">
                        <!--Data Apertura-->
                        <div class="col-6">
                            <div class="row"><label class="col-12 col-form-label">Data Apertura:</label></div>
                            <div class="row">
                                <label for="dataAperturaDa" class="col-4 col-form-label text-right">Da:</label>
                                <div class="col-8">
                                    <div class="input-group">
                                        <input id="dataAperturaDa" class="form-control" [class.is-invalid]="dataAperturaDa.invalid && (dataAperturaDa.dirty || dataAperturaDa.touched)" placeholder="yyyy-mm-dd" formControlName="dataAperturaDa"  bdiDatepicker #datepickerDAda="bdiDatepicker" maxlength="10"  style="background-color: #ffffff !important"/>
                                        <div class="input-group-append" (click)="datepickerDAda.toggle()" style="cursor: pointer;">
                                            <span class="input-group-text">
                                                <i class="fa fa-calendar"></i>
                                            </span>
                                        </div>
                                        <div  *ngIf="!!dataAperturaDa.value"  class="input-group-append" (click)="reset('dataAperturaDa')" style="cursor: pointer;">
                                            <span class="input-group-text">
                                                <i class="fas fa-trash-alt"></i>
                                            </span>
                                        </div>

                                        <div *ngIf="dataAperturaDa.errors?.dateformat && (dataAperturaDa.dirty || dataAperturaDa.touched)" class="invalid-feedback">
                                            Campo non valido
                                        </div>
                                        <div *ngIf="dataAperturaDa.errors?.daterange && (dataAperturaDa.dirty || dataAperturaDa.touched)" class="invalid-feedback">
                                            Intervallo non valido
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br/>
                            <div class="row">
                                <label for="dataAperturaA" class="col-4 col-form-label text-right">A:</label>
                                <div class="col-8">
                                    <div class="input-group">
                                        <input id="dataAperturaA" class="form-control" [class.is-invalid]="dataAperturaA.invalid && (dataAperturaA.dirty || dataAperturaA.touched)" placeholder="yyyy-mm-dd" formControlName="dataAperturaA"  bdiDatepicker #datepickerDAa="bdiDatepicker" maxlength="10" style="background-color: #ffffff !important"/>
                                        <div class="input-group-append" (click)="datepickerDAa.toggle()" style="cursor: pointer;">
                                            <span class="input-group-text">
                                                <i class="fa fa-calendar"></i>
                                            </span>
                                        </div>
                                        <div  *ngIf="!!dataAperturaA.value"  class="input-group-append" (click)="reset('dataAperturaA')" style="cursor: pointer;">
                                            <span class="input-group-text">
                                                <i class="fas fa-trash-alt"></i>
                                            </span>
                                        </div>

                                        <div *ngIf="dataAperturaA.errors?.dateformat && (dataAperturaA.dirty || dataAperturaA.touched)" class="invalid-feedback">
                                            Campo non valido
                                        </div>
                                        <div *ngIf="dataAperturaA.errors?.daterange && (dataAperturaA.dirty || dataAperturaA.touched)" class="invalid-feedback">
                                            Intervallo non valido
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="utenteInserimento" class="col-2 col-form-label">Utente Inserimento:</label>
                        <div class="col-4">
                            <div class="input-group">
                                <input id="utenteInserimento" class="form-control" [class.is-invalid]="utenteInserimento.invalid && (utenteInserimento.dirty || utenteInserimento.touched)" formControlName="utenteInserimento" maxlength="4000" [pattern]="'^[a-zA-Z0-9%]+$'"/>
                                <ng-container *ngTemplateOutlet="wildcardTooltip"></ng-container>
                                <div *ngIf="utenteInserimento.errors?.wildcard && (utenteInserimento.dirty || utenteInserimento.touched)" class="invalid-feedback">
                                    Campo non valido per la ricerca con wildcard
                                </div>
                                <div *ngIf="utenteInserimento.errors?.pattern && (utenteInserimento.dirty || utenteInserimento.touched)" class="invalid-feedback">
                                    Campo non valido
                                </div>
                            </div>
                        </div>

                        <label for="utenteApprovatore" class="col-2 col-form-label">Utente Approvatore:</label>
                        <div class="col-4">
                            <div class="input-group">
                                <input id="utenteApprovatore" class="form-control" [class.is-invalid]="utenteApprovatore.invalid && (utenteApprovatore.dirty || utenteApprovatore.touched)" formControlName="utenteApprovatore" maxlength="4000" [pattern]="'^[a-zA-Z0-9%]+$'"/>
                                <ng-container *ngTemplateOutlet="wildcardTooltip"></ng-container>
                                <div *ngIf="utenteApprovatore.errors?.wildcard && (utenteApprovatore.dirty || utenteApprovatore.touched)" class="invalid-feedback">
                                    Campo non valido per la ricerca con wildcard
                                </div>
                                <div *ngIf="utenteApprovatore.errors?.pattern && (utenteApprovatore.dirty || utenteApprovatore.touched)" class="invalid-feedback">
                                    Campo non valido
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="row mb-2">
                        <div class="col-2 mx-auto">
                            <button class="btn btn-block btn-primary" type="button" (click)="submit(target)">Cerca</button>
                        </div>
                    </div>
                </form>

                <div #target>
                    <app-generic-table *ngIf="showTable" [model]="partyModel" (action)="onActionEvent($event)" (colToDisplay)="onColToDisplayEvent($event, this.partyService.insertContoSearchPartyModel)" (paginationChanged)="onPaginationEvent($event, this.partyService.insertContoSearchPartyModel)" (sortChanged)="onSortEvent($event, this.partyService.insertContoSearchPartyModel)" (filterChanged)="onFilterEvent($event, this.partyService.insertContoSearchPartyModel)"></app-generic-table>
                </div>
            </ng-container>
            <br/>
            <div class="row mb-2">
                <div class="col-3">
                    <button routerLink="{{backUrl}}" [queryParams]="{back:true}" class="btn btn-block btn-primary" type="button">Indietro</button>
                </div>
                <div class="col-3 offset-md-6">
                    <button class="btn btn-block btn-primary" type="button" (click)="goToStep2()">Conto non Attestato presso Banca d'Italia</button>
                </div>
            </div>
        </div>

        <ng-template #waiting>
            <gepa-spinning-loader></gepa-spinning-loader>
        </ng-template>
    </div>

    <ng-template #wildcardTooltip>
        <div class="input-group-append" bdiTooltip="{{util.getWildcardTooltip()}}" placement="right" >
        <span class="input-group-text" >
            <i class="fas fa-info-circle"></i>
        </span>
        </div>
    </ng-template>
</div>
